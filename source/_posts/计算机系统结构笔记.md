---
title: 计算机系统结构笔记
date: 2020-07-07 23:58:09
tags:
- 课程笔记
mathjax: true

---

# 计算机系统结构笔记  



## 前言

​		网课的现状可能是明明自己不学习，却还要做笔记骗自己吧

<!-- more -->		

## 第一章-计算机系统结构的基本概念

### 引言

1.第一台通用电子计算机诞生于**1946**年 

2.计算机技术的飞速发展得益于两个方面 
	计算机**制造**技术的发展	
	计算机**系统结构**的创新

3.经历了4个发展过程 
	① 两种原因都有	
	② **集成电路**的制造技术的发展
	③**RISC**系统结构创新的发展
	④ 功耗限制，指令级并行性限制，存储器读写性能限制

4.系统结构的重大转折：从单纯依靠**指令级并行**转向开发**线程级并行和数据级并行**。



### 计算机系统结构的概念

简而言之，系统结构一次意味着**硬件与软件**的有机组合，我们依托于计算机语言由低级向高级的发展，可将计算机系统按功能划分为以下几个层次。
**微程序机器级-机器语言级-操作系统虚拟机-汇编语言虚拟机-高级语言虚拟机-应用语言虚拟机**



虚拟机即用软件实现的机器。

语言实现的两种基本技术**翻译与解释**，翻译即将所有指令都转换为机器语言后执行程序，解释即运行到当前指令时才将当前指令转换为机器语言。

程序员所看到的计算机属性，即概念性结构与功能特性。按照计算机系统的多级层次结构，不同级程序员所看到的计算机具有不同的属性。而对于那些我们无法感受到却真实存在的属性我们称其为**透明**的。

广义的系统结构定义：**指令集结构、组成、硬件**

对于通用寄存器型机器来说，这些属性主要是指：指令系统 数据表示 寻址规则 中断系统 机器工作状态的定义和切换 存储系统 信息保护 I/O结构

计算机系统结构概念的实质：确定计算机系统中软、硬件的界面，界面之上是软件实现的功能，界面之下是硬件和固件实现的功能。

计算机组成着眼于各设备与功能的**逻辑**关系，而计算机实现着眼于**器件**技术

冯氏分类法：用系统的最大并行度对计算机进行分类。（最大并行度：字宽×同时可处理字数）

Flynn分类法 ：按照指令流和数据流的多倍性进行分类。（有SISD,MISD,SIMD,MIMD）

计算机系统设计的四个定量原理：

​	① 以经常性事件为重点

​	② Amdahl定律：加快某部件执行速度所能获得的系统性能加速比，受限于该部件的执行时间占系统中总执行时的百分比

​			**公式为：$加速比=\frac{1}{不可加速百分比+\frac{可改进比例}{部件加速比}}$ **

​	③ CPU 性能公式。执行一个程序所需的CPU 时间 = IC ×CPI ×时钟周期时间

​	④ 程序的局部性原理。包含空间局部性与时间局部性

### 冯诺依曼模型

部件包括：I/O,CU,MEM,ALU

CU是核心结构，指令和数据同等对待。

**模拟和仿真**都是实现移植的方法，但模拟是全软件实现的，仿真虽然也需要软件但同时求硬件系统也有要求。



### 并行性

并行性：计算机系统在**同一时刻或者同一时间间隔**内进行多种运算或操作

​	同时性：两个或两个以上的事件在同一时刻发生。

​	并发性：两个或两个以上的事件在同一时间间隔内发生。 

数据处理等级由下到上：字串位串，字串位并，字并位串，全并行

执行程序等级由下到上：指令内部并行，指令级并行，线程级并行，任务级或过程级并行，作业或程序级并行

**增加并行性的途径**

​	① 时间重叠，在同一时间让不同设备处理不同任务

​	② 资源重复，重复设置设备数

​	③ 资源共享，不同任务轮流使用设备

## 第二章-计算机指令集结构

区别指令集主要由CPU内存储单元类型决定，其主要有：堆栈，累加器，通用寄存器组，分别代表三种不同的结构，通用寄存器组结构根据操作数来源可进一步划分为RR结构，RM结构，MM结构。操作数可以隐式给出（如乘法），也可显性给出（如加法）

### 寻址方式

① 寄存器寻址，操作数均为寄存器。
② 立即值寻址，操作数中存在立即数。
③ 偏移寻址，操作数为MEM[Regs[Rx]+立即数]的方法取得。
④ 寄存器间接寻址，操作数为MEM[Regs[Rx]]的方法取得。
⑤ 索引寻址，操作数为MEM[Regs[Rx1]+Regs[Rx2]]的方法取得。
⑥ 直接寻址或绝对寻址，操作数为MEM[立即数]的方法取得
⑦ 存储器间接寻址，操作数为MEM[MEM[Regs[Rx]]]的方法取得
⑧ 自增寻址，计算后寄存器内容自增。
⑨ 自减寻址，计算前寄存器内容自减。
⑩ 缩放寻址，操作数为MEM[1立即数+Regs[Rx1]+Regs[Rx2]]的方法取得

### 指令集结构的功能设计

硬件实现速度快、成本高、灵活性差，软件实现则相反。但设计过程中要确保以下四种基本要求可以被满足。

① 完整性，保证指令够用，能完成可解任务
② 规整性，包括对称性（保证操作码设置对等）和均匀性（保证各种指令都兼容各种操作数类型与字长）
③ 高效率 ④ 兼容性

两种指令集结构的计算机系统
① **CISC**，硬件执行大部分工作，指令数量多。
② **RISC**，将一部分工作交给软件，指令数量少。

### 操作数

操作数大小字节（8位）、半字（16位）字（32位）、双字（64位）

字符：用ASCII码表示，为一个字节大小。
整数：用二进制补码表示，其大小可以是字节、半字或单字。
浮点操作数：单精度浮点数（1个字）、双精度浮点数（双字）。
十进制操作数类型
	压缩十进制或二进制编码十进制（BCD码）：用4位二进制编码表示数字0～9，并将两个十进制数字合并到一个字节中存储。
	非压缩十进制：将十进制数直接用字符串来表示。

操作码的编码：Huffman编码法，固定长度的操作码

指令集的3种编码格式：变长编码格式、定长编码格式、混合型编码格式

### MIPS

#### MIPS的寄存器：

32个64位通用寄存器（GPRs），1.32个64位浮点数寄存器（FPRs），一些特殊寄存器。

#### MIPS的数据表示：

整数：字节（8位）  半字（16位）字（32位）  双字（64位）
浮点数：单精度浮点数（32位） 双精度浮点数（64位）
字节、半字或者字在装入64位寄存器时，用零扩展或者用符号位扩展来填充该寄存器的剩余部分。装入以后，对它们将按照64位整数的方式进行运算。

#### MIPS的指令格式

I类指令：
	包含立即数的指令，load，store，分支，寄存器跳转
	格式为6位操作码，5位rs，5位rt，16位立即数

R类指令：
	包括ALU指令、专用寄存器读/写指令、move指令等。
	格式为6位操作码，5位rs，5位rt，5位rd以及其他位。

J类指令：
	包括跳转指令、跳转并链接指令、自陷指令、异常返回指令。
	格式为6位操作码和26位偏移量。

#### MIPS的操作

load和store、ALU操作、分支与跳转、浮点操作



## 第三章-流水线技术

​	有相当大一部分内容与计算机组成原理相同，故不在此赘述。

吞吐率=指令数/总时间

减速比=加速前/加速后

效率=工作时空数/总时空数

数据相关，名相关（反相关，输出相关），控制相关

## 第四章-指令集并行

通过**流水线**让指令重叠的潜在的并行性称为指令级并行

实际CPI要在理想CPI的基础上考虑结构冲突，数据冲突，控制冲突带来的停顿

IPC：每个时钟周期完成的指令条数

基本程序块：一段除了入口和出口以外不包含其他分支的线性代码段。

循环级并行：使一个循环中的不同循环体并行执行。

三种相关：数据相关，名相关，控制相关

流水线冲突是指由于相关的存在使得下一条指令不能在指定的时间周期运行

### 指令的动态调度

静态调度：在编译时完成，通过将相关的指令拉开距离来完成。
动态调度：依靠专门的硬件实时的工作。 

### Tomasulo 算法

操作数就绪就执行减少RAW冲突的可能性，寄存器换名消除WAR，WAW。

指令流入-指令等待-指令就绪-指令执行-指令流出

## 重要计算公式

加速比、CPU时间、平均访存时间

通道流量分析 

TS：设备选择时间	TD：传送一字节的时间	p：设备数		n：每台设备传送字节数	k：数据块含字节数		T：完整时间

字节多路通道：$f_{MAX-BYTE}=\frac{pn}{(TS+TD)pn}=\frac{1}{TS+TD}$ $f_{BYTE}=\sum_{i=1}^pf_i$

选择通道：p台设备传送n个数据的时间$T_{SELECT}=pT_S+pnT_D$ $f_{MAX-SELECT}=\frac{pn}{T_{SELECT}}=\frac{1}{\frac{T_S}{n}+T_D}$

数组多路通道：$f_{MAX-BYTE}=\frac{pn}{(\frac{TS}{k}+T_D)pn}=\frac{1}{\frac{TS}{k}+T_D}$

## 问答题

1. 简述计算机系统的层次结构（从计算机语言的角度）。

   **微程序机器级-机器语言级-操作系统虚拟机-汇编语言虚拟机-高级语言虚拟机-应用语言虚拟机**

2. 什么是虚拟机？为什么要使用虚拟机？

   用软件的方法实现的计算机，提高了共享性

3. 什么是翻译？什么是解释？

   翻译是静态的，预处理的；解释是动态的，实时处理的；

4. 计算机系统结构、计算机组成和计算机实现三者之间的关系，并举例说明。

   计算机系统结构：软硬件的界面，机器语言程序员看到的传统机器具有的属性

   计算机组成：计算机系统结构的逻辑实现

   计算机实现：计算机组成的物理实现

5. 什么是软件的可移植性？实现软件可移植性的常用方法有哪三种？

   系列机，模拟仿真，统一高级语言

6. 什么是模拟？什么是仿真？

   模拟：**软件**的方法实现另一台计算机的指令集

   仿真：**微程序**的方法解释另一台机器的指令集

7. Flynn分类法将计算机系统结构分成哪四类？请简述。

   SISD,SIMD,MISD,MIMD

8. 请简述程序局部性原理。

   空间局部性：程序使用的数据在空间上可能相邻或相近

   时间局部性：程序使用的时间上相邻的数据可能相同

9. 简述Amdahl定律。

   加速某部件的效果受限于该部件在总执行时间的百分比

10. 影响CPU时间的因素包括什么？（提示：从CPU公式入手，考虑3个参数的影响因素）

    CPU时间=IC\*CPI\*时钟周期时间
    指令数，每条指令执行的时间周期数，时间周期时间

11. 冯诺依曼体系结构的特点。

    运算器、控制器、I/O、存储器

    （1）单处理机结构，机器以**运算器**为中心；
    （2）采用**程序存储**思想；
    （3）**指令**和数据一样可以参与**运算**；
    （4） 数据以**二进制**表示；
    （5）将**软件和硬件完全分离**；
    （6） 指令由**操作码和操作数**组成；
    （7）指令**顺序**执行。 [4]

12. 简述现代计算机对比冯诺依曼体系结构，在哪几个方面进行了改进。

    输入输出:DMA、IO处理机

    采用并行技术

    存储器组织：CACHE

    指令集：RISC

13. 什么是系列机？什么是兼容机？

    系列机：同一厂家生产的相同系统结构不同组成和实现的计算机

    兼容机：不同厂家生产的具有相同系统结构的计算机

14. 什么是软件兼容？软件兼容有几种？其中哪一种是软件兼容的根本特征？

    向上，向下（档次），向前，向后（时代）

    向后兼容是最根本的，这是系列机可以成系列的基础

15. 什么是并行性？

    同一时刻或同一时间间隔进行多种运算或操作

16. 简要说明提高计算机系统并行性的3种技术途径，并分别从单机和多机系统的角度举例。

    时间重叠，例流水线，不同设备运行不同指令

    资源重复，多个同种设备运行不同指令

    资源共享，分时系统

17. 增强CISC机器的指令功能主要从哪几方面着手？

    增强指令功能，增加运算，传送，控制指令的功能

    面向高级语言优化指令集，减少编译复杂度

    面向操作系统的优化指令集

18. 简述CISC存在的主要问题。

    各种指令使用频率相差大，最常用的往往是最简单的指令

    指令集庞大，使得硬件复杂

    指令操作复杂，使得CPI增加

    规整性差，不适合流水线

19. 简述RISC的优缺点及设计RISC机器的一般原则。

    指令少而简单，统一指令格式，指令在单个机器周期完成，访存交给ls指令，硬联逻辑来实现指令

20. 根据CPU内部存储单元类型，可将指令集结构分为哪几类？

    堆栈型指令集结构、累加器型指令集结构、通用寄存器型指令集结构

21. 常见的三种通用寄存器型指令集结构是什么？

    RR、RM、MM

22. 计算机指令集结构设计所涉及的内容有哪些？

    (1) 指令集功能设计：主要有RISC和CISC两种技术发展方向。

    (2) 寻址方式的设计。

    (3) 操作数表示和操作数类型。

    (4) 寻址方式的表示：可以将寻址方式编码于操作码中，也可以将寻址方式作为一个单独的域来表示。

    (5) 指令集格式的设计：有变长编码格式、固定长度编码格式和混合型编码格式三种。

23. 流水技术有哪些特点？

    把一个过程分成若干个子程序，每个子程序由专门的部件完成

    各段时间尽可能相等

    有一个功能部件后都要有一个缓冲寄存器

    需要不断的提供任务才能体现效率

    需要通过时间（第一个任务从流入到流出的时间）和排空时间（最后一个任务流入到流出的时间）

24. 什么是静态流水线？什么是动态流水线？

    对于多功能流水线，若同一时间内只有实现一种功能则为静态流水线，若可以实现多个功能则为动态流水线

25. 什么是单功能流水线？什么是多功能流水线？

    单功能，只能完成一种功能的流水线，多功能，按照段的不同连接方式一条流水线上可以实现不同功能。

26. 什么是线性流水线？什么是非线性流水线？

    线性流水线，各段按照串行方式连接，没有反馈回路，数据对于每个段只能流过一次

    非线性流水线，有反馈回路。

27. 列举3种相关。

    数据相关，名相关，控制相关

28. 流水线中有哪三种冲突？各是什么原因造成的？

    结构冲突，硬件资源限制无法实现流水线。

    数据冲突，指令需要前面指令的运行结果

    控制相关，分支指令导致PC变化

29. 选择至少2种解决流水线结构冲突的方法简述

    插入气泡，建立Cache

30. 选择至少2种解决流水线数据冲突的方法简述。

    定向技术，气泡，指令调度

31. 选择至少2种解决流水线控制冲突的静态方法简述。

    冻结或者排空流水线

    软件减少分支：预测分支失败，预测分支成功，延迟分支（分支延时槽）

32. 简述流水寄存器的作用。

    当产生数据冲突时，我们可以利用流水寄存器将数据直接传送到需要的地方

33. 简述分支延迟槽的主要思想。

    将分支指令视作分支指令与若干个分支延迟槽，无论分支是否成功都运行延时槽内的指令

34. 简述分支延迟槽的三种调度策略。

    从前，从目标处，从失败处

35. 简述流水线冻结/排空策略。

    暂停流水线的运作，直到分支指令结束

36. 什么是静态调度？什么是动态调度？动态调度的优点是什么？

    静态调度，在编译阶段完成对代码的调度优化，让相关指令拉开距离减少停顿

    动态调度，执行过程中由硬件完成，降低编译器复杂度，更具有可行性

37. 简述Tomasulo算法的基本思想。

    操作数就绪就立刻执行减少RAW冲突

    寄存器换名消除WAW,WAR

38. 什么是动态分支预测？有何优点？

    根据分支指令过去的表现来预测将来的行为。有更好的预测准确度和适应性

39. 简述分支历史表BHT的基本思想。

    用BHT记录分支指令最近的执行情况，并据此预测

40. 简述分支目标缓冲器BTB的基本思想。

    缓存分支成功的指令与其目标地址。

41. 简述基于硬件的前瞻算法基本思想。

    ①动态预测分支，②并运行预测结果目标的指令，并将结果写入缓冲中，知道确认后在写入寄存器或存储器

    ③动态调度策略，跨基本快调度

42. 单级存储器的主要矛盾是什么？通常采取什么方法来解决？

    速度，容量与价格之间的矛盾，采用多级存储结构。

43. “Cache-主存”和“主存-辅存”层次的主要区别是什么？

	|          \\           |     Cache-主存     |     主存-辅存      |
	| :-------------------: | :----------------: | :----------------: |
	|         目的          | 弥补主存速度的不足 | 弥补主存容量的不足 |
	|    存储管理的实现     |        硬件        |        软件        |
	|        速度比         |       几比一       |      几万比一      |
	|        块大小         |     几十个字节     |   几百几千个字节   |
	| CPU对第二级的访问方式 |      直接访问      |     通过第一级     |
	|   不命中时是否中断    |         否         |         是         |
	
44. 在存储层次中应解决哪四个问题？

    映射规则，查找算法，替换算法，写策略

45. 简述Cache的基本工作原理。

    Cache的读写速度比主存好，由于局部性原理的存在，我们可以以块为单位在Cache中缓冲一部分主存的内容。我们将主存地址分为块地址和块内偏移，有主存地址的块地址搜索Cache，若命中则可以取出内容，若不命中则去访问主存。

46. 在Cache-主存层中，地址映像方法有哪几种？它们各有什么优缺点？

    全相联：每块数据都可以放在cache的任意位置，空间利用率高，冲突概率低，实现最复杂

    直接映射：对某块数据他只能被放在指定的位置，空间利用率最低，冲突概率最高，实现最简单。

    组相连模式：折中方案，对某块数据他只能被放在指定的组，组内有多个位置可供放置

47. 简单使用比较器进行4路组相联Cache并行查找的过程。

    对于主存地址中的块地址，我们取模得到组号亦即索引，在对应组中顺序查找是否有匹配项

48. Cache-主存层常用的替换算法有哪些？

    LRU、FIFO

49. 简述Cache写命中时的两种写策略。

    写回法，写直达

50. 简述Cache写失效的两种处理方法。

    按写分配、不按写分配

51. 影响平均访存时间的因素有哪些？针对每个因素，各举出1种改进方法。

    平均访存时间=命中时间+不命中率*不命中开销

    伪相联平均访问时间= 直接映像命中时间+（直接映像的不命中率 - 2路组相联的不命中率）* 伪命中额外开销 + 二路组相联不命中率*不命中开销

52. Cache的3C失效是哪三种失效？针对每种失效给出一种降低失效率的方法。

    强制性不命中，冷启动时的不命中

    容量不命中，容量满后，块被换出后又被访问

    冲突不命中，组相连和直接映射组内换入换出造成的不命中。

53. 多体交叉存储器有哪两种编址方式？各有什么特点。

    高位交叉编址：列优先，同一个体中的高log2m位都是相同的

    低位交叉编址：行优先，同一个体中的低log2m位都是相同的

54. 反映输入/输出系统可靠性能的参数有哪些？

    可靠性：平均无故障时间MTTF

    可用性：$可用性=\frac{MTTF}{MTTF+MTTR}$ MTTF+MTTR：平均失效间隔时间MTBF

    可信性：服务的质量。即在多大程度上可以合理地认为服务是可靠的。**（不可以度量）**

55. 总线仲裁要解决的是什么问题，总线仲裁的方法有哪些，各有什么特点。

    总线仲裁要解决的问题是多设备争抢总线资源时，总线资源的分配问题。

    集中式仲裁

    1. 链式查询方式，授权信号按顺序遍历各个I/O接口，当遍历到的I/O对总线有申请时，将总线分配给它。优点是容易增加设备，缺点是设备间相关性强，顺序前的设备出错很可能导致其后设备都无法被查询。
    2. 计数器定时查询方式，计数器每次+1时并行的接受所有设备的总线请求，当计数器与设备编号相同，且设备有总线请求时将总线资源分配给他。优点是可以设定优先级，缺点是增加设备时需要额外的设备支持。
    3. 独立请求方式，中央仲裁器独立的接受所有设备的请求，按照内部设定的排队规则分配总线资源

      分布式总线仲裁，增加总线仲裁功能，当设备请求来临时对比总线上的仲裁号与请求设备的仲裁号，优先级高者获得总线资源。

56. 总线的通信控制解决的是什么问题？大致有哪些方式。

    总线的通信控制解决的是通信双方如何协调工作，何时开始，何时结束。大致包括同步通信、异步通信、版同步通信和分离式通信（分离事务总线）。

57. 试比较程序查询、程序中断、DMA三种I/O方式的区别。

    （1）程序查询方式中，是通过指令进行I/O设备的查询，以及读取数据。也就是说，数据流是经过CPU的。只要I/O设备没准备好， CPU也不干别的，就一直查询。
    （2）程序中断方式中，CPU发出了I/O命令后，I/O设备自行去做准备，CPU返回用户程序，该干啥干啥。直到I/O设备准备好了，向CPU提出中断请求，CPU和I/O设备进行数据交换（实际是跟I/O接口）。这样，实际上就是实现了非数据交换时间，CPU和I/O设备并行。但是要注意，这种方式，数据流也是经过CPU的。
    （3）DMA，全称叫做Direct Memory Access，直接存储访问。顾名思义，数据流不经过CPU，直接在存储器（内存）和I/O设备之间（实际也是I/O接口）进行数据交换，CPU起到的作用是管理作用。所以，一般来说，DMA方式一处理就是一组数据。 但是，CPU和DMA存在一个访存矛盾，就是同一时刻，只有CPU或DMA一个设备访存，所以，存在三种CPU和DMA访存方式：停止CPU访问、周期挪用、交替访问。 所谓的周期挪用，挪用的是CPU的存储周期。
    （4）通道处理机，既然叫做 处理机， 他的功能更为强大，已经不仅限于DMA的设置作用了，它能够通过执行通道指令来进行输入输出，甚至处理异常。

58. 简述通道的主要功能。

    接收CPU发来的I/O指令，并根据指令要求选择指定的外设与通道相连接。

    执行通道程序

    给出外设中要进行读/写操作的数据所在的地址

    给出主存缓冲区的首地址

    控制外设与主存缓冲区之间的数据传送的长度

    指定传送工作结束时要进行的操作

    检查外设的工作状态是否正常，并将该状态信息送往主存指定单元保存。

    在数据传输过程中完成必要的格式变换

59. 简述通道完成一次数据传输的主要过程。

    在用户程序中使用访管指令进入管理程序，由管理程序生成一个通道程序，并启动通道。通道请求中断

60. 简述三种通道传输方式及其传输过程。

    字节多路通道：字节交叉地分时为多台中低速设备服务

    选择通道：一段时间内独占地为高速设备服务，可以连接多台设备

    数组多路通道：每次为一台高速设备传输一个数据块，轮流为多台设备服务